<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Heatmaps</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100%;
        }

        #time-line {
            padding: 3px 5px;
            background-color : #fff;
            border : 2px solid #fff;
            border-radius : 3px;
            box-shadow : 0 2px 6px rgba(0,0,0,.3);
            cursor : pointer;
            width: 30%;
            text-align: center;
            z-index: 1;
        }
        #time-line input{
            width: 100%;
        }

        #product-line{
            padding: 3px 5px;
            background-color : #fff;
            border : 2px solid #fff;
            border-radius : 3px;
            box-shadow : 0 2px 6px rgba(0,0,0,.3);
            cursor : pointer;
            width: 135px;
            z-index: 1;
        }
    </style>
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
</head>

<body>
<div id="time-line">
    <span id="month">Month: 1</span>
    <input type="range" id="timeCtrl" min="1" max="12" step="1" value="0"/>
</div>
<div id="product-line">
    <label>Product: </label>
    <select id="productCtrl">
        <option value="Office">Office</option>
        <option value="Windows">Windows</option>
    </select>
</div>
<div id="map"></div>
<script>

    var map, heatmap;
    var allData;
    var currentProduct = "Office", currentMonth = 1;

    function initMap() {
        var sanFrancisco = new google.maps.LatLng(37.774546, -122.433523);
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 13,
            center: sanFrancisco,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            streetViewControl: false,
            mapTypeControl: false
        });

        map.controls[google.maps.ControlPosition.TOP_CENTER].push(document.getElementById("time-line"));
        map.controls[google.maps.ControlPosition.LEFT_CENTER].push(document.getElementById("product-line"));

        map.addListener('zoom_changed', function() {
            var zoomNumber = map.getZoom();
            console.log(zoomNumber)
            if( zoomNumber == 13){
                //City Level
            }else if( zoomNumber == 14){
                //State Level
            }
        });
        var heatMapData = [
            {location: new google.maps.LatLng(37.782, -122.447), weight: 0.5},
            new google.maps.LatLng(37.782, -122.445), // default weight is 1
            {location: new google.maps.LatLng(37.782, -122.443), weight: 2},
            {location: new google.maps.LatLng(37.782, -122.441), weight: 3},
            {location: new google.maps.LatLng(37.782, -122.439), weight: 2},
            new google.maps.LatLng(37.782, -122.437),
            {location: new google.maps.LatLng(37.782, -122.435), weight: 0.5},

            {location: new google.maps.LatLng(37.785, -122.447), weight: 3},
            {location: new google.maps.LatLng(37.785, -122.445), weight: 2},
            new google.maps.LatLng(37.785, -122.443),
            {location: new google.maps.LatLng(37.785, -122.441), weight: 0.5},
            new google.maps.LatLng(37.785, -122.439),
            {location: new google.maps.LatLng(37.785, -122.437), weight: 2},
            {location: new google.maps.LatLng(37.785, -122.435), weight: 3}
        ];
        heatmap = new google.maps.visualization.HeatmapLayer({
            data: heatMapData,
            map: map
        });
    }

    function updateMapData(){
        var mapData = allData.map(function(p){
            var loc = new google.maps.LatLng(p.coordinate.lat, p.coordinate.lng);
            var weight = p.products[currentProduct]["amounts"][currentMonth - 1];
            return {
                location : loc,
                weight : weight
            }
        });

        heatmap.setData(mapData);
    }

    $(document).ready(function(){
        $.getJSON("testdata/invoice.json", function(data){
            allData = data;
        });
        $("#productCtrl").change(function(){
            currentProduct = $(this).val();
            updateMapData()
        })
        $("#timeCtrl").change(function(){
            currentMonth = $(this).val();
            $("#month").html("Month: " + currentMonth);
            updateMapData()
        })
    })


</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCWCwAb7V9Hw4-ZUExp6EA0gJBHilBW_NM&signed_in=true&libraries=visualization&callback=initMap">
</script>
</body>
</html>